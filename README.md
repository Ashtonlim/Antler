# Installation

There are 3 components to Antler.

1. Frontend (React)
2. Cors (Node.js)
3. Backend (Django) + Database (mysql/postgresSQL)

I have migrated from mysql to postgresSQL, it is much simple to install postgresSQL, so use that, but either should work. While the details for docker are explained below,
I would avoid it as some of us had issues that I did not resolve and instead just moved on to manual installation of a DB.

# Frontend

Client package manager NPM

How to start:
Ensure you have downloaded NPM (v7.5.3) and Node.js (v15.8.0)

Note: Other versions and Node/NPM may have issues with the current package versions or cause other conflicts.

From the command line, input:

```
> cd .\client\
> npm install --legacy-peer-deps
> npm start
```

wait for server to run, it should auto open a tab on your browser at localhost:3000
--legacy-peer-deps is added as there were some issues with upgrading versions. Issues like these can be
solved with tools like docker and package managers. But as the team size is small, the effort of going
through the setup was not worth it.

# CORS

```
> cd .\cors\
> npm install
> npm start
```

Please prefix any requests with 'http://localhost:8080/' or CORS from src/api/config.js to proxy yr request thru a CORS server
Read here for more info https://github.com/Rob--W/cors-anywhere/

# Backend

This project backend was created with Django Cli

## Available Scripts

In the project directory (y2stud), you can run:

## Pipenv

Python V1.8.x or 1.9.x should work fine.

Simply run `pipenv install` to install dependancies on directory that contains Pipfile

run `pipenv shell` to start pipenv environment, please do this on `server` folder, everytime before you running server

### `cd server/chillicrab`

Windows

### `python manage.py runserver`

Mac

### `python3 manage.py runserver`

Runs the server<br />
Open [http://localhost:8000](http://localhost:8000) to view the server in the browser.

As we are using Django for backend only, we will be using only

Models & View framework from Django. T (template) will not be used.

Views is where all the logic will be implemented.

## Sub systems (App) creation

### `python manage.py startapp <appname>`

This will create a new app directory under the main project `y2stud`.
Usually, each app is responsible for one function of the application and interact with each other using public classes available from project folder

# Database

Create a database called `y2stud` using your SQL workbench (or equivalent terminal / GUI).

username: `root`

password: none

Please edit details in ./server/chillicrab/y2stud/settings.py according to your database.
Engine needs to be changed accordingly to the database used.

###### PostgresSQL
```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': 'y2stud',
        'USER': 'root',
        'PASSWORD': '',
        'HOST': '127.0.0.1',
        'PORT': '5432'
    }
}
```

###### mysql
```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'y2stud',
        'USER': 'root',
        'PASSWORD': '',
        'HOST': '127.0.0.1',
        'PORT': '3306'
    }
}
```

### Creating database using docker

```
$docker run --name mysql1 -v /home/mysql-data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=y2stud -e MYSQL_DATABASE=y2stud -e MYSQL_USER=y2stud -p 3306:3306  -e MYSQL_PASSWORD=y2stud -d mysql:latest
```

1. change /home/mysql-data to your own path: eg: C:/mysql-data or /home/user/mysql-data, can be any foler name, here use mysql-data
2. -p 3306:3306 is host:container, mapping host port 3306 to container port 3306
3. It will create database y2stud, user y2stud and its password y2stud
4. Verify:

```
$docker ps
CONTAINER ID  IMAGE                           COMMAND  CREATED        STATUS            PORTS                   NAMES
b85ca4f5a681  docker.io/library/mysql:latest  mysqld   5 seconds ago  Up 5 seconds ago  0.0.0.0:3306->3306/tcp  mysql1

//or you can use mysql workbench to connect
$ docker exec -it mysql1 bash
$ mysql -u y2stud -p

//mysql command
mysql> show database;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| y2stud             |
+--------------------+

mysql> use y2stud;     //use "exit" to quit
```

## Migrations

cd to y2stud with `manage.py`
run `python3 manage.py migrate`

Your database should now have a list of tables generated by Django. We will update settings.py to load DB config from .env file in the later part

## Loading Seed Data

cd to y2stud with `manage.py`
run `./manage.py loaddata stocks`

This will load your database with all stocks


export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"